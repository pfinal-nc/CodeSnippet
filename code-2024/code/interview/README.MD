### 面试题收集

1. 分布式锁有那些实现方式?

   > 1.基于数据库实现分布式锁
   >
   > 2.基于缓存 redis等实现分布式锁
   >
   > 3.基于 zookeeper实现分布式锁

2. Mysql死锁产生的原因是什么?

   > 1.并发事务更新相同的数据集--当多个事务同时更新相同的数据集,并且使用了不同的顺序来获取锁时候,
   > 就可能产生死锁。例如,事务A先锁住数据集X,然后尝试获取数据集Y的锁,而事务B先锁住数据集Y，然后尝试获取数据集X的锁,
   这样就形成了死锁。
   >
   > 2.事务持有锁等待其他事务释放锁--当一个事务持有一个资源的锁,并且尝试获取另一个事务持有的资源的锁时,如果另一个事务也在等待当前事务持有的锁释放,
   > 就会导致死锁
   >
   > 3.锁粒度过大: 当锁的粒度过大时，多个事务同时访问相同的资源时会增加死锁的可能性, 例如:
   > 当一个事务锁定了整个表,而另一个事务也尝试锁定同一张表时,就可能产生死锁.
   >
   > 4.事务超时或者异常终止: 如果一个事务在持有所得过程中出现了超时或者异常终止,而此时该事务持有的锁没有被释放,就可能导致其他事务在等待该所的释放时出现死锁

>

3. 避免MySQL死锁的方法包括:

   > 1.使用合适的事务持有锁的时间,以减少死锁的可能性
   >
   > 2.尽量减少事务持有锁的时间,以缩短死锁发生的窗口
   >
   > 3.优化数据库设计, 避免长时间持有锁和锁的粒度过大。
   >
   > 4.监控和诊断数据库死锁, 并即使处理死锁事件
   >
   > 5.在应用层面设计良好的事务管理策略,以最小化死锁的可能性


4. Redis 哨兵的原理是什么？

   > redis 哨兵模式是 redis的高可用解决方案, 它为Redis 实例提供自动故障转移和主节点选举

   > 1. 监控, 在 redis 分布式系统中 多个 redis 节点组成一个主从复制(master-slave)结构, redis sentinel会监控所有节点的运行状态,
        包括主节点和从节点

   > 2. 自动故障检测: 当一个节点出现故障时，哨兵会立即感知到，并且根据预先配置的策略，自动地进行故障转移，将一个从节点提升为新的主节点，以保证系统的可用性

   > 3. 故障转移: 故障转移是 Redis Sentinel 的核心功能之一。当主节点失效时，哨兵会协调从节点中选举出一个新的主节点，然后通知客户端进行更新，使系统能够继续工作

   > 4. Redis Sentinel 还负责管理 Redis 分布式系统的配置信息。它可以监控配置变化，并在需要时自动地对配置进行更新，以确保系统的正确性

   > 5. 提供服务发现: 哨兵可以提供服务发现功能, 使客户能够动态地发现 redis 分布式系统中可用的节点, 并与之建立连接

5. API网关集群如何设计?

   > 1.负载均衡: 在API网关集群前面部署负载均衡器, 如 nginx, haproxy等, 以均衡流量分发到不同的API网关实例上.
   负载均衡器可以基于轮询,IP哈希, Least Connections等算法进行流量分发。

   > 2.高可用性: 每个API网关实例都应该是高可用的, 即使某个实例出现故障, 整个系统仍能继续工作。可以通过部署多个API
   网关实例,并使用负载均衡器进行故障转移来实现高可用性。

   > 3.扩展性: API网关集群应该能够根据需要动态地扩展和缩减实例数量, 可以采用自动化部署和容器化技术,
   如Docker和Kubernetes，来实现快速地扩展和收缩。

   > 4.安全性: API 网关应该提供安全功能,包括认证, 授权, API秘钥管理, 数据加密等.可以通过继成认证服务.使用HTTPS协议通信,
   实施访问控制策略等方式来提高安全性
   
   > 5.监控和日志： 在 API 网关集群中集成监控和日志功能，可以实时监控流量、性能指标、错误率等，并记录请求日志、错误日志等信息，以便及时发现和解决问题

   > 6.灰度发布： 为了降低发布新版本的风险，可以采用灰度发布策略，逐步将流量引导到新版本的 API 网关上，并根据反馈结果决定是否全面发布新版本

   > 7.容错和限流:  API 网关应该具备容错和限流的能力，能够应对突发流量和故障情况。可以通过实施断路器模式、限制并发连接数、实现请求重试等方式来增强容错性和限流能力。


6. swoole的event事件管理工作原理？

   > swoole 的事件管理机制是基于事件循环 event loop 实现的,其工作原理是:
   
   > 1. 事件循环: Swoole 的事件是基于事件循环模型,该模型在单个线程中循环监听各种事件(如I/O事件,定时器时间等) 并在事件发生时触发相应的回调函数进行处理.
   
   > 2. 异步非阻塞I/O: Swoole 使用异步非阻塞I/O模型.在进行网络通信时不会因为等待I/O操作而阻塞当前线程,从而能够高效地处理大量并发请求
   
   > 3. 事件分发与调度: 当某个事件发生时, 事件循环会立即调用相应的注册回调函数进行处理. 例如: 当有客户端连接到服务器时,时间循环会触发连接事件, 并调用相应的连接回调函数进行处理


